<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Cardano.CoinSelection.LargestFirst</title><link href="ocean.css" rel="stylesheet" type="text/css" title="Ocean" /><link rel="stylesheet" type="text/css" href="quick-jump.css" /><script src="haddock-bundle.min.js" async="async" type="text/javascript"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.0/MathJax.js?config=TeX-AMS-MML_HTMLorMML" type="text/javascript"></script></head><body><div id="package-header"><ul class="links" id="page-menu"><li><a href="src/Cardano.CoinSelection.LargestFirst.html">Source</a></li><li><a href="index.html">Contents</a></li><li><a href="doc-index.html">Index</a></li></ul><p class="caption">cardano-coin-selection-1.0.0: Algorithms for coin selection and fee balancing.</p></div><div id="content"><div id="module-header"><table class="info"><tr><th valign="top">Copyright</th><td>&#169; 2018-2020 IOHK</td></tr><tr><th>License</th><td>Apache-2.0</td></tr><tr><th>Safe Haskell</th><td>None</td></tr><tr><th>Language</th><td>Haskell2010</td></tr></table><p class="caption">Cardano.CoinSelection.LargestFirst</p></div><div id="description"><p class="caption">Description</p><div class="doc"><p>This module contains an implementation of the <strong>Largest-First</strong> coin
 selection algorithm.</p></div></div><div id="synopsis"><details id="syn"><summary>Synopsis</summary><ul class="details-toggle" data-details-id="syn"><li class="src short"><a href="#v:largestFirst">largestFirst</a> :: (<a href="../base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> i, <a href="../base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> o, <a href="../base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m) =&gt; <a href="Cardano-CoinSelection.html#t:CoinSelectionAlgorithm" title="Cardano.CoinSelection">CoinSelectionAlgorithm</a> i o m</li></ul></details></div><div id="interface"><h1>Documentation</h1><div class="top"><p class="src"><a id="v:largestFirst" class="def">largestFirst</a> :: (<a href="../base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> i, <a href="../base-4.12.0.0/Data-Ord.html#t:Ord" title="Data.Ord">Ord</a> o, <a href="../base-4.12.0.0/Control-Monad.html#t:Monad" title="Control.Monad">Monad</a> m) =&gt; <a href="Cardano-CoinSelection.html#t:CoinSelectionAlgorithm" title="Cardano.CoinSelection">CoinSelectionAlgorithm</a> i o m <a href="src/Cardano.CoinSelection.LargestFirst.html#largestFirst" class="link">Source</a> <a href="#v:largestFirst" class="selflink">#</a></p><div class="doc"><p>An implementation of the <strong>Largest-First</strong> coin selection algorithm.</p><h1>Overview</h1><p>The <strong>Largest-First</strong> algorithm processes outputs in <em>descending order of</em>
 <em>value</em>, from <em>largest</em> to <em>smallest</em>.</p><p>For each output, it repeatedly selects the <em>largest</em> remaining unspent UTxO
 entry until the value of selected entries is greater than or equal to the
 value of that output.</p><h1>State Maintained by the Algorithm</h1><p>At all stages of processing, the algorithm maintains:</p><ol><li><p>A <strong><em>remaining UTxO list</em></strong></p><p>This is initially equal to the given <em>initial UTxO set</em> parameter,
sorted into <em>descending order of coin value</em>.</p><p>The <em>head</em> of the list is always the remaining UTxO entry with the
<em>largest coin value</em>.</p><p>Entries are incrementally removed from the <em>head</em> of the list as the
algorithm proceeds, until the list is empty.</p></li><li><p>An <strong><em>unpaid output list</em></strong></p><p>This is initially equal to the given <em>output list</em> parameter, sorted
into <em>descending order of coin value</em>.</p><p>The <em>head</em> of the list is always the unpaid output with the
<em>largest coin value</em>.</p><p>Entries are incrementally removed from the <em>head</em> of the list as the
algorithm proceeds, until the list is empty.</p></li><li><p>An <strong><em>accumulated coin selection</em></strong></p><p>This is initially <em>empty</em>.</p><p>Entries are incrementally added as each output is paid for, until the
<em>unpaid output list</em> is empty.</p></li></ol><h1>Cardinality Rules</h1><p>The algorithm requires that:</p><ol><li>Each output from the given <em>output list</em> is paid for by <em>one or more</em>
      entries from the <em>initial UTxO set</em>.</li><li><p>Each entry from the <em>initial UTxO set</em> is used to pay for <em>at most one</em>
      output from the given <em>output list</em>.</p><p>(A single UTxO entry <strong>cannot</strong> be used to pay for multiple outputs.)</p></li></ol><h1>Order of Processing</h1><p>The algorithm proceeds according to the following sequence of steps:</p><ul><li><p><em>Step 1</em></p><p>Remove a single <em>unpaid output</em> from the head of the
<em>unpaid output list</em>.</p></li><li><p><em>Step 2</em></p><p>Repeatedly remove UTxO entries from the head of the
<em>remaining UTxO list</em> until the total value of entries removed is
<em>greater than or equal to</em> the value of the <em>removed output</em>.</p></li><li><p><em>Step 3</em></p><p>Use the <em>removed UTxO entries</em> to pay for the <em>removed output</em>.</p><p>This is achieved by:</p><ul><li>adding the <em>removed UTxO entries</em> to the <code><a href="Cardano-CoinSelection.html#v:inputs" title="Cardano.CoinSelection">inputs</a></code> field of the
   <em>accumulated coin selection</em>.</li><li>adding the <em>removed output</em> to the <code><a href="Cardano-CoinSelection.html#v:outputs" title="Cardano.CoinSelection">outputs</a></code> field of the
   <em>accumulated coin selection</em>.</li></ul></li><li><p><em>Step 4</em></p><p>If the <em>total value</em> of the <em>removed UTxO entries</em> is greater than the
value of the <em>removed output</em>, generate a coin whose value is equal to
the exact difference, and add it to the <code><a href="Cardano-CoinSelection.html#v:change" title="Cardano.CoinSelection">change</a></code> field of the
<em>accumulated coin selection</em>.</p></li><li><p><em>Step 5</em></p><p>If the <em>unpaid output list</em> is empty, <strong>terminate</strong> here.</p><p>Otherwise, return to <em>Step 1</em>.</p></li></ul><h1>Termination</h1><p>The algorithm terminates <strong>successfully</strong> if the <em>remaining UTxO list</em> is
 not depleted before the <em>unpaid output list</em> can be fully depleted (i.e., if
 all the outputs have been paid for).</p><p>The <em>accumulated coin selection</em> and <em>remaining UTxO list</em> are returned to
 the caller.</p><h3>Failure Modes</h3><p>The algorithm terminates with an <strong>error</strong> if:</p><ol><li><p>The <em>total value</em> of the initial UTxO set (the amount of money
      <em>available</em>) is <em>less than</em> the total value of the output list (the
      amount of money <em>required</em>).</p><p>See: <strong><code><a href="Cardano-CoinSelection.html#t:InputValueInsufficientError" title="Cardano.CoinSelection">InputValueInsufficientError</a></code></strong>.</p></li><li><p>The <em>number</em> of entries in the initial UTxO set is <em>smaller than</em> the
      number of requested outputs.</p><p>Due to the nature of the algorithm, <em>at least one</em> UTxO entry is
required <em>for each</em> output.</p><p>See: <strong><code><a href="Cardano-CoinSelection.html#t:InputCountInsufficientError" title="Cardano.CoinSelection">InputCountInsufficientError</a></code></strong>.</p></li><li><p>Due to the particular <em>distribution</em> of values within the initial UTxO
      set, the algorithm depletes all entries from the UTxO set <em>before</em> it
      is able to pay for all requested outputs.</p><p>See: <strong><code><a href="Cardano-CoinSelection.html#t:InputsExhaustedError" title="Cardano.CoinSelection">InputsExhaustedError</a></code></strong>.</p></li><li><p>The <em>number</em> of UTxO entries needed to pay for the requested outputs
      would <em>exceed</em> the upper limit specified by <code><a href="Cardano-CoinSelection.html#v:limit" title="Cardano.CoinSelection">limit</a></code>.</p><p>See: <strong><code><a href="Cardano-CoinSelection.html#t:InputLimitExceededError" title="Cardano.CoinSelection">InputLimitExceededError</a></code></strong>.</p></li></ol></div></div></div></div><div id="footer"><p>Produced by <a href="http://www.haskell.org/haddock/">Haddock</a> version 2.22.0</p></div></body></html>